{
  "appPath": "/target",
  "port": 8080,
  "db": {
    "name": "fuzz_db",
    "port": 5432,
    "host": "localhost",
    "user": "root",
    "password": "mysecretpassword"
  },
  "name": "discourse",
  "containers": [
    {
      "env": [
        {
          "name": "POSTGRES_USER",
          "value": "root"
        }
      ],
      "image": "postgres:10.5",
      "name": "my-postgres"
    },
    {
      "name": "target",
      "image": "gcr.io/athena-fuzzer/discourse:8f1bc6525d",
      "env": [
        {
          "name": "FUZZ_DB",
          "value": "fuzz_db"
        },
        {
          "name": "PORT",
          "value": "8080"
        }
      ],
      "command": [
        "bash", "-c", "createdb -p 5432 -h localhost -T template0 $FUZZ_DB && psql -p 5432 -h localhost -d $FUZZ_DB < /target/state/db.pgdump &&  redis-server --daemonize yes && TARGET_APP_PATH=`pwd` RAILS_ENV=development RAILS_MASTER=1 bundle exec bin/rails s -b 0.0.0.0 -p $PORT"
      ]
    }
  ]
}
